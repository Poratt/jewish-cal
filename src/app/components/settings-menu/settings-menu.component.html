<div class="settings-control-container no-print">
    @if(contentSettings(); as settings) {
    <div class="settings-tabs-container" (wheel)="$event.stopPropagation()">
        <mat-tab-group dir="rtl" dynamicHeight class="custom-tabs sm" stretchTabs>
            <mat-tab>
                <ng-template mat-tab-label>
                    <div class="tab-label">
                        <span class="pi pi-cog"></span>
                        <span>כללי</span>
                    </div>
                </ng-template>
                <div class="settings-tab-content">
                    <div class="settings-section">
                        <label class="section-label">
                            <span class="pi pi-map-marker"></span>
                            <span>מיקום</span>
                        </label>
                        <p-select #locationDropdown
                            [ngModel]="selectedLocation()"
                            (ngModelChange)="onLocationUpdated($event)"
                            [options]="groupedCities()"
                            optionLabel="cityHeb"
                            [group]="true"
                            [filter]="true"
                            filterBy="cityHeb" 
                            placeholder="בחר עיר" 
                            dropdownIcon="pi pi-search"
                            icon
                            class="w-full">
                            <ng-template pTemplate="selectedItem">
                                @if(selectedLocation(); as location) {
                                <div class="flex items-center gap-2">
                                    <span>{{ location.cityHeb }}</span>
                                </div>
                                }
                            </ng-template>
                            <ng-template pTemplate="filter" let-options="options">
                                <div class="flex items-center gap-2 p-2">
                                    <i class="pi pi-search"></i>
                                    <input type="text" 
                                        [value]="options.filter" 
                                        (input)="options.filterCallback($event)" 
                                        placeholder="הכנס שם עיר.."
                                        class="flex-1 p-inputtext">
                                </div>
                            </ng-template>
                            <ng-template let-group pTemplate="group">
                                <div class="flex items-center country-group">
                                    <span class="flag"
                                        [class]="'flag-' + (group.items[0].countryCode | lowercase)"></span>
                                    <span>{{ group.countryHeb }}</span>
                                </div>
                            </ng-template>
                            <ng-template let-city pTemplate="item">
                                <div>{{ city.cityHeb }}</div>
                            </ng-template>
                        </p-select>
                    </div>

                    <hr class="section-divider" />

                    <div class="settings-section">
                        <label class="section-label">
                            <span class="pi pi-palette"></span>
                            <span>עיצוב</span>
                        </label>
                        <div class="form-group">
                            <label>בהירות גבולות</label>
                            <p-slider [ngModel]="borderBrightness()"
                                (onChange)="onBorderBrightnessUpdated($event)" [min]="0" [max]="100"></p-slider>
                        </div>
                        <div class="form-group">
                            <label>צבעי שבת וחג</label>
                            <div class="color-options-container">
                                @for (color of shabbatHolidayColorOptions; track color) {
                                <div class="color-swatch" [style.background-color]="color"
                                    [ngClass]="{'selected': shabbatHolidayColor() === color}"
                                    (click)="onShabbatHolidayColorUpdated(color)">
                                </div>
                                }
                            </div>
                        </div>
                        <div class="form-group-row">
                            <p-checkbox
                                class="flex"
                                size="small"
                                [ngModel]="settings.showShabbatBackgrounds"
                                (ngModelChange)="onContentSettingChange($event, 'showShabbatBackgrounds')"
                                [binary]="true"
                                inputId="shabbatBgCheck">
                            </p-checkbox>
                            <label for="shabbatBgCheck">הצג רקעים לשבת וחג</label>
                        </div>
                        <div class="form-group">
                            <label>שקיפות רקע</label>
                            <p-slider [ngModel]="shabbatBackgroundOpacity()"
                                (onChange)="onShabbatBackgroundOpacityUpdated($event)" 
                                [min]="0.005" [max]="0.04" [step]="0.000001"></p-slider>
                        </div>
                        <div class="form-group">
                            <label>פונט</label>
                            <p-select [ngModel]="selectedFont()"
                                (ngModelChange)="onFontUpdated($event)"
                                [options]="fontOptions" optionLabel="name"
                                optionValue="value"
                                placeholder="בחר פונט" styleClass="w-full font-selector">
                                <ng-template pTemplate="item" let-option>
                                    <div class="font-option">
                                        <div class="font-name">{{ option.name }}</div>
                                        <div class="font-preview" [style.fontFamily]="option.value">
                                            כ״ה אלול תשפ״ה • 25 September 2025
                                        </div>
                                    </div>
                                </ng-template>
                                <ng-template pTemplate="selectedItem" let-option>
                                    <div [style.fontFamily]="option.value">
                                        {{ option.name }}
                                    </div>
                                </ng-template>
                            </p-select>
                        </div>
                    </div>
                </div>
            </mat-tab>
            <mat-tab>
                <ng-template mat-tab-label>
                    <div class="tab-label">
                        <span class="pi pi-list"></span>
                        <span>תוכן</span>
                    </div>
                </ng-template>
                <div class="settings-tab-content">
                    <div class="settings-section">
                        <label class="section-label">
                            <span class="pi pi-align-justify"></span>
                            <span>הצגת אירועים</span>
                        </label>
                        <div class="content-settings-grid">
                            @for(item of ContentSettingsEnumData; track item.key) {
                            <div class="form-group-row">
                                <p-checkbox size="small" class="flex"
                                    [ngModel]="settings[item.key]"
                                    (ngModelChange)="onContentSettingChange($event, item.key)"
                                    [binary]="true" [inputId]="item.key">
                                </p-checkbox>
                                <label [for]="item.key">{{item.hebName}}</label>
                            </div>
                            }
                        </div>
                    </div>

                    <hr class="section-divider" />

                    <div class="settings-section">

                        <div class="flex w-full justify-between items-center">
                            <label class="section-label">
                                <span class="pi pi-book"></span>
                                <span>לימוד יומי</span>
                            </label>
                            @if(learningSelectionError()) {
                            <div @slideDown class="zmanim-error-message">
                                {{ learningSelectionError() }}
                            </div>
                            }
                        </div>
                        <div class="content-settings-grid">
                            @for(learn of LearningEnumData; track learn.key) {
                            <div class="form-group-row">
                                <p-checkbox 
                                    class="flex"
                                    size="small"
                                    [ngModel]="settings.dailyLearningVisibility[learn.key]" 
                                    (ngModelChange)="onDailyLearningVisibilityChange($event, learn.key)"
                                    [binary]="true"                                        
                                    [inputId]="'learnCheck-' + learn.key"
                                    [disabled]="!settings.dailyLearningVisibility[learn.key] && learningCheckedCount() >= maxLearningToShow">
                                </p-checkbox>
                                <label [for]="'learnCheck-' + learn.key">{{learn.hebName}}</label>
                            </div>
                            }
                            
                        </div>
                    </div>

                    <hr class="section-divider" />

                    <div class="settings-section">
                        
                        <div class="flex w-full justify-between items-center">
                            <label class="section-label">
                                <span class="pi pi-clock"></span>
                                <span>זמני היום</span>
                            </label>
                            @if(zmanimSelectionError()) {
                            <div @slideDown class="zmanim-error-message">
                                {{ zmanimSelectionError() }}
                            </div>
                            }
                        </div>
                        <div class="content-settings-grid">
                            @for(zman of ZmanimEnumData; track zman.key) {
                            <div class="form-group-row">
                                <p-checkbox size="small" class="flex"
                                    [ngModel]="settings.zmanimVisibility[zman.key]"
                                    (ngModelChange)="onZmanimVisibilityChange($event, zman.key)"
                                    [binary]="true"
                                    [inputId]="'zmanCheck-' + zman.key"
                                    [disabled]="!settings.zmanimVisibility[zman.key] && zmanimCheckedCount() >= maxZmanimToShow">
                                </p-checkbox>
                                <label [for]="'zmanCheck-' + zman.key">{{zman.hebName}}</label>
                            </div>
                            }
                        </div>
                    </div>
                </div>
            </mat-tab>
            <mat-tab>
                <ng-template mat-tab-label>
                    <div class="tab-label">
                        <span class="pi pi-print"></span>
                        <span>הדפסה</span>
                    </div>
                </ng-template>
                <div class="settings-tab-content">
                    <div class="settings-section">
                        <label class="section-label">
                            <span class="pi pi-print"></span>
                            <span>הגדרות הדפסה</span>
                        </label>
                        <div class="print-selector-form">
                            <div class="flex w-full justify-between gap-3">
                                <div class="form-group">
                                    <label>מחודש:</label>
                                    <div class="form-row">
                                        <p-datepicker
                                            panelStyleClass="custom-datepicker-panel"
                                            [(ngModel)]="printStartDate"
                                            view="month"
                                            dateFormat="mm/yy"
                                            [readonlyInput]="true" 
                                            (click)="$event.stopPropagation()" 
                                            />
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label>עד חודש:</label>
                                    <div class="form-row">
                                        <p-datepicker
                                            panelStyleClass="custom-datepicker-panel"
                                            [(ngModel)]="printEndDate"
                                            view="month"
                                            dateFormat="mm/yy"
                                            [readonlyInput]="true" 
                                            (click)="$event.stopPropagation()" />
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>כמות סטים להדפסה:</label>
                                <div class="form-row">
                                    <p-inputnumber class="sets-input" [(ngModel)]="printSets" [min]="1"
                                        [showButtons]="true" />
                                </div>
                            </div>
                            @if (printRangeError()) {
                            <div class="print-error-message">
                                {{ printRangeError() }}
                            </div>
                            }
                            <div class="flex grow items-end">
                                <button (click)="prepareAndPrint()" class="prepare-print-btn">
                                    <span class="pi pi-print"></span>
                                    <span>הכן להדפסה</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </mat-tab>
        </mat-tab-group>
    </div>
    }
</div>