@if(dayObj(); as day) {
<div class="day-details-container" [style.--theme-color]="userSettingsService.themeColorSignal()">
    <header class="day-details-header">
        <p-button severity="secondary" class="sm-icon" rounded="true" icon="pi pi-angle-right" aria-label="Previous Day" (click)="onPrevDay()"></p-button>

        <div class="header-content">
            <h3 class="header-date-hebrew">{{ day.he.fullDate }}</h3>
            <h2 class="header-date-gregorian">{{ day.ge.fullDate | date:'fullDate':'':'he' }}</h2>

            @if(userSettingsService.selectedLocationSignal(); as location) {
            <div class="header-location-badge">
                <i class="pi pi-map-marker"></i>
                <span>{{ location.cityHeb }}</span>
            </div>
            }
        </div>

        <div class="header-actions">
            @if (!isToday()) {
            <p-button @slideDown class="no-print sm-icon" severity="secondary" [rounded]="true" icon="pi pi-calendar" (click)="goToToday()" aria-label="Go to Today"></p-button>
            }
            <p-button severity="secondary" class="sm-icon" rounded="true" icon="pi pi-angle-left" aria-label="Next Day" (click)="onNextDay()"></p-button>
        </div>
    </header>

    @if(day.events && day.events.length > 0) {
    <section class="day-details-section">
        <h4 class="section-header">
            <i class="pi pi-star-fill"></i>
            <span>××™×¨×•×¢×™× ×•×—×’×™×</span>
        </h4>
        <div class="section-content">
            @if(fastDayInfo) {
            <div class="event-item">
                <span class="event-item-name">{{ fastDayInfo.name }}</span>
                @if(fastDayInfo.start || fastDayInfo.end) {
                <span class="text-grey-xs">
                    @if(fastDayInfo.start) {
                    <span>{{ fastDayInfo.start.hebName }}</span>
                    }
                    @if(fastDayInfo.start && fastDayInfo.end) {
                    <span> - </span>
                    }
                    @if(fastDayInfo.end) {
                    <span>{{ fastDayInfo.end.hebName }}</span>
                    }
                </span>
                }
            </div>
            }

            @for(event of day.events; track event.desc) {
            @if(!event.categories.includes('fast')) {
            <div class="event-item">
                <div class="event-item-wrapper" [class.justify-end]="event.categories.includes('havdalah') || event.categories.includes('candles')">
                    @if (event.categories.includes('molad')) {
                        <span class="event-item-icon ">ğŸŒ™</span>
                        <span class="event-item-name">{{ event.hebName }}</span>
                    } 
                    @else if (event.categories.includes('parashat')) {
                        <span class="event-item-icon">ğŸ“–</span>
                        <span class="event-item-name">{{ event.hebName }}</span>
                    } 
                    @else if(event.omerEvent) {
                        <div class="omer-event">
                            <span class="event-item-icon">ğŸ—“ï¸</span>
                            <span class="event-item-name">{{ event.hebName }} ({{event.omerEvent.omer}})</span>
                            <span class="text-grey-sm">{{event.omerEvent.sefira('he') }} | {{event.omerEvent.getTodayIs('he') }}</span>
                        </div>
                    }
                    @else if(event.categories.includes('havdalah') || event.categories.includes('candles')) {
                        <span class="event-item-icon">{{ event.emoji }}</span>
                        <span class="event-item-name">{{ event.hebName }}</span>
                    }
                    @else {
                        <span class="event-item-icon">{{ event.emoji }}</span>
                        <span class="event-item-name">{{ event.hebName }}</span>
                    }
                    @if (event.url) {
                    <a [href]="event.url" target="_blank" class="event-item-link pi pi-external-link" pTooltip="×§×¨× ×¢×•×“" tooltipPosition="top"></a>
                    }
                </div>
            </div>
            }
            }
        </div>
    </section>
    }

    @if(day.leyning) {
    <section class="day-details-section">
        <h4 class="section-header">
            <i class="pi pi-book"></i>
            <span>×§×¨×™××ª ×”×ª×•×¨×”</span>
        </h4>
        <div class="section-content">
            @if(day.leyning.name.he) {
            <p class="leyning-item">
                <strong class="leyning-item-label">{{ isLeyningWithFullKriyah(day.leyning) ? '×¤×¨×©×”' : '×§×¨×™××”' }}:</strong>
                <span class="leyning-item-value">{{ day.leyning.name.he }}</span>
            </p>
            }
            @if(isLeyningWithFullKriyah(day.leyning) && day.leyning.haftara) {
            <p class="leyning-item">
                <strong class="leyning-item-label">×”×¤×˜×¨×”:</strong>
                <span class="leyning-item-value">{{ getHaftaraBook(day.leyning.haftara) }} <small class="leyning-item-verses">{{ getHaftaraVerses(day.leyning.haftara) }}</small></span>
            </p>
            }

            @if(isLeyningWithFullKriyah(day.leyning)) {
            <div class="aliyot-grid">
                <strong class="aliyot-grid-title">×¡×“×¨ ×§×¨×™××”</strong>
                @for(reading of day.leyning.fullkriyah | keyvalue; track reading.key) {
                <div class="aliyah-item">
                    <strong class="aliyah-item-name">{{ aliyotMap[reading.key] || reading.key }}:</strong>
                    <span class="aliyah-item-book">{{ translate(reading.value.k) }}</span>
                    <span class="text-grey-xs">{{ formatAliyahVerses(reading.value) }}</span>
                </div>
                }
            </div>
            }
            @if(isLeyningWithWeekday(day.leyning)) {
            <div class="aliyot-grid">
                <strong class="aliyot-grid-title">×¡×“×¨ ×§×¨×™××”</strong>
                 @for(reading of day.leyning.weekday | keyvalue; track reading.key) {
                <div class="aliyah-item">
                    <strong class="aliyah-item-name">{{ aliyotMap[reading.key] || reading.key }}:</strong>
                    <span class="aliyah-item-book">{{ translate(reading.value.k) }}</span>
                    <span class="text-grey-xs">{{ formatAliyahVerses(reading.value) }}</span>
                </div>
                }
            </div>
            }
        </div>
    </section>
    }

    @if(filteredGroupedZmanim(); as groupedZmanim) {
    <section class="day-details-section">
        <div class="section-header-with-control">
            <h4 class="section-header">
                <i class="pi pi-clock"></i>
                <span>×–×× ×™ ×”×™×•×</span>
            </h4>
            <div class="toggle-switch" [class.right]="defaultZmanimMethod() === ZmanimMethodType.Gra" (click)="toggleZmanimMethod(defaultZmanimMethod())">
                @for (method of ZmanimMethodsData; track $index) {
                    <span class="toggle-switch-text" [class.active]="method.key === defaultZmanimMethod()">
                        {{method.fullname}}
                    </span>
                }
            </div>
        </div>
        <div class="section-content zmanim-grid">
            @if (groupedZmanim.morning.items.length > 0) {
            <div class="zmanim-group">
                <span class="zmanim-group-title">{{ groupedZmanim.morning.data.hebName }}</span>
                <div class="zmanim-group-row">
                    @for (zman of groupedZmanim.morning.items; track zman.key) {
                        <div class="zman-item" tooltipPosition="bottom" [pTooltip]="getZmanDescription(zman.key)" [ngClass]="getZmanStatus(zman)">
                            <span class="zman-item-name" [innerHTML]="zman.hebName | parenthesesStyle"></span>
                            <span class="zman-item-time">{{ zman.time }}</span>
                        </div>
                    }
                </div>
            </div>
            }
            @if (groupedZmanim.afternoon.items.length > 0) {
            <div class="zmanim-group">
                <span class="zmanim-group-title">{{ groupedZmanim.afternoon.data.hebName }}</span>
                <div class="zmanim-group-row">
                    @for (zman of groupedZmanim.afternoon.items; track zman.key) {
                        <div class="zman-item" tooltipPosition="bottom" [pTooltip]="getZmanDescription(zman.key)" [ngClass]="getZmanStatus(zman)">
                            <span class="zman-item-name" [innerHTML]="zman.hebName | parenthesesStyle"></span>
                            <span class="zman-item-time">{{ zman.time }}</span>
                        </div>
                    }
                </div>
            </div>
            }
            @if (groupedZmanim.evening.items.length > 0) {
            <div class="zmanim-group">
                <span class="zmanim-group-title">{{ groupedZmanim.evening.data.hebName }}</span>
                <div class="zmanim-group-row">
                    @for (zman of groupedZmanim.evening.items; track zman.key) {
                        <div class="zman-item" tooltipPosition="bottom" [pTooltip]="getZmanDescription(zman.key)" [ngClass]="getZmanStatus(zman)">
                            <span class="zman-item-name" [innerHTML]="zman.hebName | parenthesesStyle"></span>
                            <span class="zman-item-time">{{ zman.time }}</span>
                        </div>
                    }
                </div>
            </div>
            }
        </div>
    </section>
    }
    
    @if(hasLearningContent()) {
    <section class="day-details-section">
        <h4 class="section-header">
            <i class="pi pi-graduation-cap"></i>
            <span>×œ×™××•×“ ×™×•××™</span>
        </h4>
        <div class="section-content">
            <div class="learning-grid">
                @for (learn of LearningEnumData; track learn.key) {
                @if (getLearning(day, learn.key)) {
                <div class="learning-item" tooltipPosition="bottom" [pTooltip]="learn.desc">
                    <strong class="learning-item-title">{{ learn.hebName }}:</strong>
                    <span class="text-grey-xs" [innerHtml]="getLearning(day, learn.key)"></span>
                </div>
                }
                }
            </div>
        </div>
    </section>
    }
</div>
}