@if(dayObj(); as day) {
<div class="day-details-container" [style.--theme-color]="userSettingsService.themeColorSignal()">
    <div class="day-details-header">
        <p-button severity="secondary" class="sm-icon" rounded="true" icon="pi pi-angle-right" aria-label="Previous Month" (click)="onPrevDay()"></p-button>

        <div class="header-text">
            <h3 class="hebrew-date">{{ day.he.fullDate }}</h3>
            <h2 class="gregorian-date">{{ day.ge.fullDate | date:'fullDate':'':'he' }}</h2>

            @if(userSettingsService.selectedLocationSignal(); as location) {
            <div class="location-badge">
                <i class="pi pi-map-marker"></i>
                <span>{{ location.cityHeb }}</span>
            </div>
            }
            
        </div>
        <p-button severity="secondary" class="sm-icon" rounded="true" icon="pi pi-angle-left" aria-label="Next Month" (click)="onNextDay()"></p-button>

    </div>

    @if(day.events && day.events.length > 0) {
    <div class="details-section">
        <h4>
            <i class="pi pi-star-fill"></i>
            专注 
        </h4>
        <ul>
            <!-- Display combined fast day info first -->
            @if(fastDayInfo) {
            <li>
                {{ fastDayInfo.name }}
                @if(fastDayInfo.start || fastDayInfo.end) {
                <span class="verses">
                    @if(fastDayInfo.start) {
                    <span>{{ fastDayInfo.start.hebName }}</span>
                    }
                    @if(fastDayInfo.start && fastDayInfo.end) {
                    <span> - </span>
                    }
                    @if(fastDayInfo.end) {
                    <span>{{ fastDayInfo.end.hebName }}</span>
                    }
                </span>
                }
            </li>
            }

            <!-- Display other events-->
            @for(event of day.events; track event.desc) {
            @if(!event.categories.includes('fast')) {
            <li>
                <div class="event-item-wrapper">
                    @if (event.url) {
                    <a [href]="event.url" target="_blank" class="event-url-link pi pi-external-link" pTooltip="拽专 注" tooltipPosition="top"></a>
                    }

                    @if (event.categories.includes('molad')) {
                    <div class="event-content">
                        <span class="rotate-90 -mr-[3px] -ml-0.5"></span>
                        <span>{{ event.hebName }}</span>
                    </div>
                    } 
                    @else if(event.omerEvent) {
                    <div class="event-content">
                        <div class="flex flex-col items-center">
                            <span>{{ event.hebName }}</span>
                            <span class="omer-details">({{event.omerEvent.omer}})</span>
                        </div>
                        <div class="flex flex-col omer-details">
                            <span>{{event.omerEvent.sefira('he') }}</span>
                            <span>{{event.omerEvent.getTodayIs('he') }}</span>
                        </div>
                    </div>
                    }
                    @else if(event.categories.includes('havdalah') || event.categories.includes('candles')) {
                    <div class="event-content w-full justify-end">
                        <span>{{ event.emoji }} {{ event.hebName }}</span>
                    </div>
                    }
                    @else {
                    <div class="event-content">
                        <span>{{ event.emoji }} {{ event.hebName }}</span>
                    </div>
                    }
                </div>
            </li>
            }
            }
        </ul>
    </div>
    }

    @if(day.leyning) {
    <div class="details-section">
        <h4>
            <i class="pi pi-book"></i>
            拽专转 转专
        </h4>
        @if(day.leyning.name.he) {
        <p><strong>{{ isLeyningWithFullKriyah(day.leyning) ? '驻专砖' : '拽专' }}:</strong>
            {{ day.leyning.name.he }}</p>
        }
        @if(isLeyningWithFullKriyah(day.leyning) && day.leyning.haftara) {
        <p>
            <strong>驻专:</strong>
            {{ getHaftaraBook(day.leyning.haftara) }}
            <span class="text-grey-xs">{{ getHaftaraVerses(day.leyning.haftara) }}</span>
        </p>
        }

        @if(isLeyningWithFullKriyah(day.leyning)) {
        <div class="leyning-details">
            <h5>住专 拽专</h5>
            <ul>
                @for(reading of day.leyning.fullkriyah | keyvalue; track reading.key) {
                <li>
                    <strong>{{ aliyotMap[reading.key] || reading.key }}:</strong>
                    {{ translate(reading.value.k) }}
                    <span class="text-grey-xs pr-4">{{ formatAliyahVerses(reading.value) }}</span>
                </li>
                }
            </ul>
        </div>
        }
        @if(isLeyningWithWeekday(day.leyning)) {
        <div class="leyning-details">
            <h5>住专 拽专</h5>
            <ul>
                @for(reading of day.leyning.weekday | keyvalue; track reading.key) {
                <li>
                    <strong>{{ aliyotMap[reading.key] || reading.key }}:</strong>
                    {{ translate(reading.value.k) }}
                    <span class="text-grey-xs pr-4">{{ formatAliyahVerses(reading.value) }}</span>
                </li>
                }
            </ul>
        </div>
        }
    </div>
    }

    @if(day.zmanim) {
    <div class="details-section">
        <h4>
            <i class="pi pi-clock"></i>
             
        </h4>
        <ul class="zmanim-grid">
            @for(zman of dayObj()?.zmanim; track zman.name) {
            <li><strong>{{ zman.hebName }}:</strong> {{ zman.time }}</li>
            }
        </ul>
    </div>
    }

    @if(hasLearningContent()) {
    <div class="details-section">
        <h4>
            <i class="pi pi-graduation-cap"></i>
             
        </h4>
        <ul class="zmanim-grid">
            @for (learn of LearningEnumData; track learn.key) {
            @if (getLearning(day, learn.key)) {
            <li>
                <strong [pTooltip]="learn.desc">{{ learn.hebName }}:</strong>
                <span class="verses" [innerHtml]="getLearning(day, learn.key)"> </span>
            </li>
            }
            }
        </ul>
    </div>
    }
</div>
}